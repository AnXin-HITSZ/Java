# 第六章：面向对象编程（基础）

**目录：**

[TOC]

---

本章专题与脉络：
![第 2 阶段：面向对象编程 - 第 06 章](./images/20251203193538.png "第 2 阶段：面向对象编程 - 第 06 章")

学习面向对象内容的三条主线：
* Java 类及类的成员：（重点）属性、方法、构造器；（熟悉）代码块、内部类；
* 面向对象的特征：封装、继承、多态（、抽象）；
* 其他关键字的使用：`this`、`super`、`package`、`import`、`static`、`final`、`interface`、`abstract` 等。

## 一、面向对象编程概述（了解）

### 1.1 程序设计的思路

面向对象，是软件开发中的一类编程风格、开发范式。除了面向对象，还有面向过程、指令式编程和函数式编程。在所有的编程范式中，我们接触最多的还是面向过程和面向对象两种。

> 类比 - 史书类型：
> * 纪传体：以人物传记为中心，“本纪”叙述帝王、“世家”记叙王侯封国和特殊人物，“列传”记叙民间人物。
> * 编年体：按年、月、日顺序编写。
> * 国别体：是一部分国记事的历史散文，分载多国历史。

早期先有面向过程思想，随着软件规模的扩大、问题复杂性的提高，面向过程的弊端越来越明显，出现了面向对象思想并成为目前主流的方式。

1. **面向过程的程序设计思想（Process-Oriented Programming）**，简称 `POP`：
   * 关注的焦点是**过程**：过程就是操作数据的步骤。如果某个过程的实现代码重复出现，那么就可以把这个过程抽取为一个**函数**。这样就可以大大简化冗余代码，便于维护。
   * 典型的语言：C 语言。
   * 代码结构：以**函数**为组织单位。
   * 是一种“**执行者思维**”，适合解决简单问题。扩展能力差、后期维护难度较大。
2. **面向对象的程序设计思想（Object Oriented Programming）**，简称 `OOP`：
   * 关注的焦点是**类**：在计算机程序设计过程中，参照现实中事物，将事物的属性特征、行为特征抽象出来，用类来表示。
   * 典型的语言：Java、C#、C++、Python、Ruby 和 PHP 等。
   * 代码结构：以**类**为组织单位。每种事物都具备自己的**属性**和**行为 / 功能**。
   * 是一种“**设计者思维**”，适合解决复杂问题。代码扩展性强、可维护性高。

### 1.2 由实际问题考虑如何设计程序

**思考 1：如何开车？**

面向过程思想思考问题时，我们首先思考“**怎么按步骤实现？**”并将步骤对应成方法，一步一步，最终完成。这个适合**简单任务**，不需要**过多协作**的情况。针对如何开车，可以列出步骤：
![针对“如何开车”的步骤](./images/20251203195458.png "针对“如何开车”的步骤")

面向过程适合简单、不需要协作的事务，重点关注如何执行。

**思考 2：如何造车？**

造车太复杂，需要**很多协作**才能完成。此时我们思考的是“**车怎么设计？**”，而不是“怎么按特定步骤造车的问题”。这就是思维方式的转变，前者就是面向对象思想。所以，面向对象（Oriented-Object）思想更契合人的思维模式。

用面向对象思想思考“如何设计车”：
![“如何设计车” - 采用面向对象思想思考](./images/20251203195806.png "“如何设计车” - 采用面向对象思想思考")

自然地，我们就会从“车由什么组成”开始思考。发现，车由如下结构组成：
![“车由什么组成”](./images/20251203195920.png "“车由什么组成”")

我们找轮胎厂完成制造轮胎的步骤，发动机厂完成制造发动机的步骤，……；这样，大家可以同时进行车的制造，最终进行组装，大大提高了效率。但是，具体到轮胎厂的一个流水线操作，仍然是有步骤的，还是离不开面向过程思维！

因此，**面向对象可以帮助我们从宏观上把握、从整体上分析整个系统。**但是，具体到实现部分的微观操作（就是一个个方法），仍然需要面向过程的思路去处理。

> 注意：我们千万不要把面向过程和面向对象对立起来。它们是相辅相成的。面向对象离不开面向过程！

**类比举例 1：**
![事务处理 - 创业中员工的从少到多](./images/20251203203604.png "事务处理 - 创业中员工的从少到多")
> 当需求单一，或者简单时，我们一步步去操作没问题，并且效率也挺高。
>
> 可随着需求的更改、功能的增多，发现需要面对每一个步骤很麻烦了，这时就开始思索，**能不能把这些步骤和功能进行封装，封装时根据不同的功能，进行不同的封装，功能类似的封装在一起。**这样结构就清晰了很多。用的时候，找到对应的类就可以了。这就是面向对象的思想。

**类比举例 2 - 人把大象装进冰箱：**
* 面向过程：
    ```java
    1. 打开冰箱

    2. 把大象装进冰箱

    3. 把冰箱门关住

    ```
* 面向对象：
    ```java
    人{
        打开(冰箱){
            冰箱.开门();
        }
        操作(大象){
            大象.进入(冰箱);
        }
        关闭(冰箱){
            冰箱.关门();
        }
    }

    冰箱{
        开门(){ }
        关门(){ }
    }

    大象{
        进入(冰箱){ }
    }

    ```

练习：抽象出下面系统中的“类”及其关系。
![练习 - 抽象出该系统中的“类”及其关系](./images/20251203210031.png "练习 - 抽象出该系统中的“类”及其关系")

## 二、Java 语言的基本元素：类和对象

### 2.1 引入

人认识世界，其实就是面向对象的。比如，我们认识一下美人鱼（都没见过）：
![美人鱼](./images/20251203200715.png "美人鱼")

经过“仔细学习”，发现美人鱼通常具备一些特征：
* 女孩；
* 有鱼尾；
* 美丽。

这个总结的过程，其实是**抽象化**的过程。抽象出来的美人鱼的特征，可以归纳为一个**美人鱼类**。而图片中的都是这个类呈现出来的**具体的对象**。

### 2.2 类和对象概述

**类（Class）**和**对象（Object）**是面向对象的核心概念。

**1. 什么是类？**
**类**：具有相同特征的事物的抽象描述，是**抽象的**、概念上的定义。

**2. 什么是对象？**
**对象**：实际存在的该类事物的**每个个体**，是**具体的**，因而也称为**实例（instance）**。

![“抽象概念的人”和“实实在在的某个人”](20251203201147.png "“抽象概念的人”和“实实在在的某个人”")
可以理解为：`类 => 抽象概念的人` 而 `对象 => 实实在在的某个人`。

![“手机的设计图”和“真正的手机”](./images/20251203201342.png "“手机的设计图”和“真正的手机”")

![“车”和“我的爱车”](./images/20251203201423.png "“车”和“我的爱车”")

**3. 类与对象的关系错误理解**

> 曰：“白马非马，可乎？”
> 曰：“可。”
> 曰：“何哉？”
> 曰：“马者，所以命形也。白者，所以命色也。命色者，非命形也，故曰白马非马。”

![“白马非马”](./images/20251203201755.png "“白马非马”")

### 2.3 类的成员概述

> 面向对象程序设计的重点是**类的设计**。
>
> 类的设计，其实就是**类的成员的设计**。

现实世界的生物体，大到鲸鱼，小到蚂蚁，都是由最基本的**细胞**构成的。同理，Java 代码世界是由诸多个不同功能的**类**构成的。
![细胞](./images/20251203202044.png "细胞")

现实生物世界中的细胞又是由什么构成的呢？细胞核、细胞质、……
Java 中用类 class 来描述事物也是如此。类，是一组相关**属性**和**行为**的集合，这也是类最基本的两个成员。
* **属性**：该类事物的状态信息。对应类中的**成员变量**。
  * `成员变量 <=> 属性 <=> Field（字段、域）`。
* **行为**：该类事物要做什么操作，或者基于事物的状态能做什么。对应类中的**成员方法**。
  * `（成员）方法 <=> 函数（、过程） <=> Method`。

![简历中的“属性”与“行为”](./images/20251203202439.png "简历中的“属性”与“行为”")

举例：
![具体代码中的属性和方法示例](/images/0251203202548.png "具体代码中的属性和方法示例")

### 2.4 面向对象完成功能的三步骤（重要）

**步骤 1：类的定义**

类的定义使用关键字：`class`。格式如下：
```java
[修饰符] class 类名{
    属性声明;
    方法声明;
}
```

**步骤 2：对象的创建**

![对象的创建](./images/20251205102939.png "对象的创建")

创建对象，使用关键字：`new`。

创建对象语法：
```java
// 方式 1：给创建的对象命名
// 把创建的对象用一个引用数据类型的变量保存起来，这样就可以反复使用这个对象了
类名 对象名 = new 类名();

// 方式 2：
new 类名(); // 也称为匿名对象
```

**步骤 3：对象调用属性或方法**

对象是类的一个**实例**，必然具备该类事物的属性和行为（即方法）。

使用 “`对象名.属性`” 或 “`对象名.方法`” 的方式访问对象成员（包括属性和方法）。

示例代码：
* `Phone.java`：
```java
public class Phone {

    // 属性
    String name;    // 品牌
    double price;   // 价格


    // 方法
    public void call(){
        System.out.println("手机能够拨打电话");
    }

    public void sendMessage(String message){
        System.out.println("发送信息：" + message);
    }

    public void playGame(){
        System.out.println("手机可以玩游戏");
    }
}

```
* `PhoneTest.java`：
```java
public class PhoneTest {    // 是 Phone 类的测试类
    public static void main(String[] args) {

        // 复习：数据类型 变量名 = 变量值
//        Scanner scann = new Scanner(System.in);

        // 创建 Phone 的对象
        Phone p1 = new Phone();

        // 通过 Phone 的对象，调用其内部声明的属性或方法
        // 格式："对象.属性" 或 "对象.方法"
        p1.name = "huawei mate50";
        p1.price = 6999;

        System.out.println("name = " + p1.name + "，price = " + p1.price);

        // 调用方法
        p1.call();
        p1.sendMessage("有内鬼，终止交易");
        p1.playGame();
    }
}

```

### 2.5 匿名对象（anonymous object）

我们也可以不定义对象的句柄，而直接调用这个对象的方法。这样的对象叫做匿名对象。
  * 如：`new Person().shout();`。

使用情况：
* 如果一个对象只需要进行一次方法调用，那么就可以使用匿名对象。
* 我们经常将匿名对象作为实参传递给一个方法调用。

## 三、对象的内存解析

### 3.1 JVM 内存结构划分

HotSpot（Oracle 自己发布的 Java 虚拟机，即官方发布的虚拟机） Java 虚拟机的架构图如下。其中我们主要关心的是运行时数据区部分（Runtime Data Area）。
![HotSpot Java 虚拟机架构图](./images/20251205103829.png "HotSpot Java 虚拟机架构图")

其中：
* **堆（Heap）**：此内存区域的唯一目的就是存放对象实例，几乎所有的对象实例都在这里分配内存。这一点在 Java 虚拟机规范中的描述是：所有的对象实例以及数组都要在堆上分配。
  * 即：`new` 出来的结构（比如：数组实体、对象的实体），包括对象中的属性。
* **栈（Stack）**：是指虚拟机栈。虚拟机栈用于存储局部变量等。局部变量表存放了编译器可知长度的各种基本数据类型（`boolean`、`byte`、`char`、`short`、`int`、`float`、`long`、`double`）、对象引用（`reference` 类型，它不等同于对象本身，是对象在堆内存的首地址）。方法执行完，自动释放。
  * 即：方法内定义的变量，存储在栈中。
* **方法区（Method Area）**：用于存储已被虚拟机加载的类信息、常量、静态变量、即时编译器编译后的代码等数据。
  * 即：存放类的模板，比如 `Person` 类的模板。

### 3.2 对象的内存解析

举例：
```java
class Person {  // 类：人
    String name;
    int age;
    boolean isMale;
}

public static PersonTest {  // 测试类
    public static void main(String[] args) {
        Person p1 = new Person();
        p1.name = "赵同学";
        p1.age = 20;
        p1.isMale = true;

        Person p2 = new Person();
        p2.age = 10;

        Person p3 = p1;
        p3.name = "郭同学";
    }
}

```
内存解析图：
![内存解析图](./images/20251205104733.png "内存解析图")

> 说明：
> * 堆：凡是 `new` 出来的结构（对象、数组）都存放在堆空间中。
> * 对象的属性存放在堆空间中。
> * 创建一个类的多个对象（比如 `p1`、`p2`），则每个对象都拥有当前类的一套“副本”（即属性）。当通过一个对象修改其属性时，不会影响其他对象此属性的值。
> * 当声明一个新的变量使用现有的对象进行赋值时（比如 `p3 = p1`），此时并没有在堆空间中创建新的对象，而是两个变量共同指向了堆空间中同一个对象；当通过一个对象修改属性时，会影响另外一个对象对此属性的调用。

**1. 创建类的一个对象，属性赋值：**

示例代码：
```java
public static void main(String[] args) {
    Person p1 = new Person();
    p1.name = "杰克";
    p1.age = 24;
    p1.gender = '男';
}
```

内存解析：
![示例代码内存解析](./images/20251205114058.png "示例代码内存解析")

**2. 创建类的多个对象，属性赋值：**

示例代码 1：
```java
public static void main(String[] args) {
    Person p1 = new Person();
    p1.name = "杰克";
    p1.age = 24;

    // 创建 Person 的对象 2
    Person p2 = new Person();
    p2.name = "露丝";
    p2.age = 20;

    p1.age = 26;
    System.out.println(p2.age); // 20
}
```
内存解析 1：
![示例代码 1 内存解析](./images/20251205114438.png "示例代码 1 内存解析")

示例代码 2：
```java
public static void main(String[] args) {
    Person p1 = new Person();
    p1.name = "杰克";
    p1.age = 24;

    // 创建 Person 的对象 2
    Person p2 = new Person();
    p2.name = "露丝";
    p2.age = 20;

    p1.age = 26;
    System.out.println(p2.age); // 20

    Person p3 = p1;
    p3.age = 28;
}
```
内存解析 2：
![示例代码 2 内存解析](./images/20251205115508.png "示例代码 2 内存解析")

强调：
**1. 创建了 `Person` 类的两个对象：**

```java
Person p1 = new Person();
Person p2 = new Person();
```
说明：创建类的多个对象时，每个对象在堆空间中有一个对象实体，每个对象实体中保存着一份类的属性；如果修改某一个对象的某属性值时，不会影响其他对象此属性的值。

示例代码：
```java
p1.age = 10;
p2.age = 20;

p1.age = 30;
System.out.println(p2.age); // 20
```
**2. 声明类的两个变量：**

```java
Person p1 = new Person();
Person p3 = p1;
```
说明：此时的 `p1`、`p3` 两个变量指向了堆空间中的同一个对象实体（或 `p1`、`p3` 保存的地址值相同）；如果通过其中某一个对象变量修改对象的属性时，会影响另一个对象变量此属性的值。

示例代码：
```java
p1.age = 10;
p3.age = 20;
System.out.println(p1.age); // 20
```

> **面试题：对象名中存储的是什么呢？**
>
> 答：对象地址。
>
> ```java
> public class StudentTest{
>     public static void main(String[] args){
>         System.out.println(new Student());  // Student@7852e922
> 
>         Student stu = new Student();
>         System.out.println(stu);    // Student@4e25154f
> 
>         int[] arr = new int[5];
>         System.out.println(arr);    // [I@70dea4e
>     }
> }
> 
> ```
> 直接打印对象名和数组名都是显示 “`类型@对象的 hashCode 值`”，所以说**类、数组都是引用数据类型，引用数据类型的变量中存储的是对象的地址，或者说指向堆中对象的首地址。**
> ![类、数组的内存解析](./images/20251205105827.png "类、数组的内存解析")